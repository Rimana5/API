<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Wishlist</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        h1 {
            margin-bottom: 20px;
        }

        form, .item {
            background: #fff;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
        }

        input, textarea {
            width: 100%;
            margin-bottom: 10px;
            padding: 8px;
        }

        button {
            padding: 8px 12px;
            margin-right: 5px;
            cursor: pointer;
        }

        .item.done {
            background: #e6ffe6;
        }
    </style>
</head>
<body>

<h1>Wishlist</h1>

<form id="form">
    <input type="text" id="title" placeholder="Название" required>
    <textarea id="description" placeholder="Описание"></textarea>
    <input type="text" id="price" placeholder="Цена">
    <input type="url" id="link" placeholder="Ссылка">
    <label>
        <input type="checkbox" id="is_achieved"> Получено
    </label>
    <br><br>
    <button type="submit">Добавить</button>
</form>

<div id="list"></div>

<script>
    const API = '/api/wishlist';

    async function loadItems() {
        const res = await fetch(API + '/');
        const items = await res.json();
        const list = document.getElementById('list');
        list.innerHTML = '';

        items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'item' + (item.is_achieved ? ' done' : '');

            div.innerHTML = `
                <strong>${item.title}</strong><br>
                ${item.description || ''}<br>
                ${item.price || ''}<br>
                ${item.link ? `<a href="${item.link}" target="_blank">Ссылка</a>` : ''}
                <br><br>
                <button onclick="toggle(${item.id}, ${!item.is_achieved})">
                    ${item.is_achieved ? 'Вернуть' : 'Получено'}
                </button>
                <button onclick="removeItem(${item.id})">Удалить</button>
            `;

            list.appendChild(div);
        });
    }

    document.getElementById('form').addEventListener('submit', async e => {
        e.preventDefault();

        const data = {
            title: title.value,
            description: description.value,
            price: price.value,
            link: link.value,
            is_achieved: is_achieved.checked
        };

        await fetch(API + '/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        e.target.reset();
        loadItems();
    });

    async function toggle(id, status) {
        const res = await fetch(API + '/' + id);
        const item = await res.json();
        item.is_achieved = status;

        await fetch(API + '/' + id, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(item)
        });

        loadItems();
    }

    async function removeItem(id) {
        await fetch(API + '/' + id, { method: 'DELETE' });
        loadItems();
    }

    loadItems();
</script>

</body>
</html>
